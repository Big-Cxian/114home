<!doctype html>
<html>
<head>
	<meta charset="UTF-8">
	<title></title>
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<link rel="stylesheet" href="../css/mui.min.css" />
	<link rel="stylesheet" href="../css/mui.picker.min.css" />
	<link rel="stylesheet" href="../css/mui.poppicker.css" />
	<link rel="stylesheet" href="../css/app.css" />
  <style type="text/css">
    .service-category-list {
      display: flex;
      flex-flow: wrap;
      padding: 10px 0 0 0;
      justify-content: space-around;
      align-content: space-between;
      width: 100%;
      height: 120px;
    }
    .btn {
      width: 30%;
    }
  	.btn label {
      padding: 0 12px;
  		display: block;
      width: 100%;
  		height: 30px;
  		border-radius: 15px;
  		text-align: center;
  		line-height: 28px;
  		font-size: 12px;
  		color: #333;
      border: 1px solid #E6E6E6;
      position: relative;
  	}
    .btn input {
    	display: none;
    }
    .btn input[type="checkbox"]:checked+label{
    	background-color: #7776FD;
    	color: #fff;
    }
    .btn input[type="checkbox"]:checked+label::after{
      content: '\e472';
      position: absolute;
    	color: #fff;
      font-size: 20px;
    }
  </style>
</head>

<body>
	<header class="mui-bar mui-bar-nav">
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"><span class="font14">返回</span></a>
		<h1 class="mui-title">服务时间</h1>
	</header>
	<div id="myapp" class="mui-content" v-cloak>
    <div class="mui-card mui-padding">
      <p class="font12 color999 padding-left-right">请选择接单星期</p>
      <div class="service-category-list">
        <div class="btn">
          <input type="checkbox" name="serviceType" checked="checked">
          <label class="mui-icon">
            星期1
          </label>
        </div>
        <div class="btn" v-for="item in serviceTime.open_week_days">
          <input type="checkbox" name="serviceType" v-model="days" :value="item.value">
          <label class="mui-icon">
            {{item.title}}
          </label>
        </div>
        <div class="btn"></div>
        <div class="btn"></div>
      </div>
    </div>
		<div class="mui-card">
			<form class="mui-input-group no-border-before no-border-after">
				<div class="mui-input-row">
					<label>服务时间</label>
					<input id="beginTime" class="mui-text-center" type="button" v-model="serviceTime.start_time">
					<span>—</span>
					<input id="endTime" class="mui-text-center" type="button" v-model="serviceTime.end_time">
				</div>
        <div class="mui-input-row">
          <label>提前预约</label>
          <input type="number" v-model="serviceTime.appointment_hours" placeholder="提前预约(小时)" >
        </div>
			</form>
		</div>
		<div class="mui-content-padded button-fix">
			<button type="button" class="mui-btn mui-btn-purple mui-btn-block buttom-button" id="save">
				<i class="mui-icon mui-icon-checkmarkempty"></i>
					保存
			</button>
		</div>
	</div>
<script type="text/javascript" src="../js/mui.min.js"></script>
<script type="text/javascript" src="../js/vue.min.js" ></script>
<script type="text/javascript" src="../js/jquery-3.3.1.min.js" ></script>
<script type="text/javascript" src="../js/mui.picker.min.js" ></script>
<script type="text/javascript" src="../js/mui.poppicker.js" ></script>
<script type="text/javascript" src="../js/city.data-3.js" ></script>
<script type="text/javascript" src="../js/app.js" ></script>
<script type="text/javascript">
	mui.init();
  var vm = new Vue({
  	el: '#myapp',
  	data: {
  		storeData: "",
      serviceTime: "",
      days: []
  	},
    methods: {
      isInArry: function (_id) {
        return(vm.days.indexOf(_id) >= 0)
      }
    }
  })
	mui.plusReady(function (){
		var heard = plus.webview.currentWebview();
    vm.storeData = heard.data;
    doAjax("/company/store/getWeek","",function(_data) {
      // console.log(JSON.stringify(_data));
      vm.serviceTime = _data;
      for(var i in _data.open_week_days) {
        if(_data.open_week_days[i].is_active) {
          vm.days.push(_data.open_week_days[i].value);
        }
      }
    })
		var options = JSON.parse('{"type":"time"}');
		var endTimePicker = new mui.DtPicker(options);
		$("#beginTime").on("tap",function() {
			endTimePicker.show(function(rs) {
				vm.serviceTime.start_time = rs.text;
			});
		})
		$("#endTime").on("tap",function() {
			endTimePicker.show(function(rs) {
				vm.serviceTime.end_time = rs.text;
			});
		})
		$("#save").on("tap",function (){
			if(vm.serviceTime.start_time == "") {
				mui.toast("请选择开始时间");
				return;
			}
			if(vm.serviceTime.end_time == "") {
				mui.toast("请选择结束时间");
				return;
			}
      if(vm.serviceTime.appointment_hours <= 0) {
      	mui.toast("请填写提前预约小时");
      	return;
      }
			plus.nativeUI.showWaiting("保存中...");
			doAjax("/company/store/updateServiceTime",{
				_token: UserInfo.data._token,
				start_time: vm.serviceTime.start_time,
				end_time: vm.serviceTime.end_time,
        appointment_hours: vm.serviceTime.appointment_hours,
        open_week_days: JSON.stringify(vm.days)
			},function(_data,_msg) {
				mui.toast(_msg);
				mui.back();
			})
		})
	})
</script>
</body>

</html>